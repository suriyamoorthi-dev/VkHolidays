<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ product.name }} - Order</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    * { font-family: 'Inter', sans-serif; }
    .card-effect { transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
    .card-effect:hover { box-shadow: 0 15px 30px rgba(0, 0, 0, 0.08); transform: translateY(-5px); }
    .btn-primary-glow {
      transition: all 0.3s ease; background-size: 200% auto;
      background-image: linear-gradient(135deg, #10b981 0%, #059669 50%, #10b981 100%);
    }
    .btn-primary-glow:hover { background-position: right center; box-shadow: 0 10px 20px rgba(16,185,129,0.4); transform: translateY(-2px); }
  </style>
</head>
<body class="bg-gradient-to-b from-gray-50 to-gray-100 min-h-screen antialiased text-gray-800">

  <div class="max-w-3xl mx-auto py-12 px-4 md:px-6">

    <!-- Product Details -->
    <div class="bg-white/90 backdrop-blur-md rounded-2xl shadow-xl overflow-hidden card-effect mb-8">
      <img src="{{ product.image_url }}" alt="{{ product.name }}" class="w-full h-72 object-cover">
      <div class="p-6 md:p-8">
        <h1 class="text-3xl md:text-4xl font-bold mb-2">{{ product.name }}</h1>
        <p class="text-gray-600 leading-relaxed mb-4 text-sm md:text-base">{{ product.description }}</p>
        <div class="flex items-center justify-between mb-4">
          <p class="text-2xl md:text-3xl font-bold text-green-700">₹{{ product.price }}</p>
          <span class="bg-gray-200 text-gray-700 text-xs md:text-sm font-medium px-3 py-1 rounded-full">In Stock</span>
        </div>

        <!-- Add to Cart & Go to Cart Button -->
<div class="flex items-center gap-4 mb-4">
  <input type="number" id="quantity" min="1" value="1"
         class="w-24 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors">
  
  <button onclick="addAndOpenCart('{{ product.id }}', '{{ product.name }}', {{ product.price }})"
          class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-bold shadow-md w-full md:w-auto">
    Add to Cart
  </button>
</div>



    <!-- Reviews -->
    <div class="bg-white/90 backdrop-blur-md mt-12 p-6 md:p-8 rounded-2xl shadow-xl card-effect">
      <h2 class="text-2xl md:text-3xl font-semibold mb-6 flex items-center">
        <i class="fa-solid fa-star text-yellow-500 mr-3"></i> Write a Review
      </h2>

      <!-- Review Form -->
      <form method="POST" action="" class="space-y-6">
        <div>
          <label for="review_name" class="block text-gray-700 font-medium mb-2">Your Name</label>
          <input type="text" id="review_name" name="name" placeholder="E.g., Anjali Sharma"
                 class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" required>
        </div>

        <div>
          <label for="rating" class="block text-gray-700 font-medium mb-2">Rating</label>
          <select id="rating" name="rating"
                  class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" required>
            <option value="">Select rating</option>
            <option value="5">⭐⭐⭐⭐⭐ - Excellent</option>
            <option value="4">⭐⭐⭐⭐ - Good</option>
            <option value="3">⭐⭐⭐ - Average</option>
            <option value="2">⭐⭐ - Poor</option>
            <option value="1">⭐ - Very Bad</option>
          </select>
        </div>

        <div>
          <label for="comment" class="block text-gray-700 font-medium mb-2">Your Review</label>
          <textarea id="comment" name="comment" placeholder="Share your thoughts..."
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-colors" rows="4" required></textarea>
        </div>

        <button type="submit" class="w-full text-white px-6 py-4 rounded-xl font-bold shadow-md btn-primary-glow">
          Submit Review
        </button>
      </form>

      <!-- Display Reviews -->
      <h2 class="text-xl font-semibold mb-3 mt-10">Customer Reviews</h2>
      <div class="space-y-4">
        {% for review in reviews %}
          <div class="p-4 bg-white rounded-lg border">
            <p class="font-semibold">{{ review.name }}</p>
            <p class="text-yellow-500">{{ '⭐' * review.rating }}</p>
            <p class="text-gray-700 mt-1">{{ review.comment }}</p>
            <p class="text-xs text-gray-400">{{ review.created_at }}</p>
          </div>
        {% else %}
          <p class="text-gray-500">No reviews yet. Be the first!</p>
        {% endfor %}
      </div>
    </div>

    <!-- Back Button -->
    <div class="mt-8">
      <a href="/home"
         class="inline-flex items-center bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-semibold shadow-lg transition transform hover:scale-105">
        <i class="fa-solid fa-arrow-left mr-2"></i> Back to Products
      </a>
    </div>

  </div>

<script>
function addAndOpenCart(id, name, price){
  // Get quantity
  let qty = parseInt(document.getElementById("quantity").value) || 1;

  // Add to cart (localStorage)
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  let existing = cart.find(p => p.id == id);
  if(existing){
    existing.qty += qty;
  } else {
    cart.push({id, name, price, qty});
  }
  localStorage.setItem('cart', JSON.stringify(cart));

  // Show success alert
  alert(`${name} x${qty} added to cart!`);

  // Open Cart Modal
  const modal = document.getElementById('cart-modal');
  if(modal){
    modal.classList.remove('hidden');
    modal.classList.add('flex');
  }
}
</script>

</body>
</html>
